<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI æ™ºèƒ½è®€æ›¸è¨ˆç•«å„€è¡¨æ¿</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome Icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <!-- Markdown Parser -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <!-- Chart.js for Data Visualization -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* è‡ªå®šç¾©æ¨£å¼èˆ‡å‹•ç•« */
        body { font-family: 'Segoe UI', 'Microsoft JhengHei', sans-serif; background-color: #f3f4f6; }
        
        /* å´é‚Šæ¬„é¸å–®æ¨£å¼ */
        .sidebar-item { transition: all 0.2s; cursor: pointer; border-left: 4px solid transparent; }
        .sidebar-item:hover { background-color: #f3f4f6; }
        .sidebar-item.active { background-color: #e0e7ff; color: #4338ca; border-left: 4px solid #4338ca; }
        
        /* å¡ç‰‡æ‡¸æµ®æ•ˆæœ */
        .card { transition: transform 0.2s, box-shadow 0.2s; }
        .card:hover { transform: translateY(-2px); box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); }
        
        /* Prompt é¡¯ç¤ºå€å¡Š */
        .prompt-box { background-color: #1e293b; color: #cbd5e1; font-family: 'Consolas', 'Monaco', monospace; position: relative; line-height: 1.6; }
        .prompt-highlight { color: #facc15; font-weight: bold; text-decoration: underline; }
        
        /* AI çµæœé¡¯ç¤ºå€å¡Š */
        .ai-result-box { background-color: #ffffff; border: 1px solid #e2e8f0; font-family: 'Segoe UI', sans-serif; line-height: 1.7; color: #334155; }
        .ai-result-box h1, .ai-result-box h2, .ai-result-box h3 { color: #1e293b; font-weight: bold; margin-top: 1em; margin-bottom: 0.5em; }
        .ai-result-box ul { list-style-type: disc; padding-left: 1.5em; }
        .ai-result-box ol { list-style-type: decimal; padding-left: 1.5em; }
        .ai-result-box strong { color: #4338ca; }
        .ai-result-box hr { margin: 1em 0; border-color: #e2e8f0; }
        .ai-result-box table { width: 100%; border-collapse: collapse; margin: 1em 0; }
        .ai-result-box th, .ai-result-box td { border: 1px solid #cbd5e1; padding: 8px; text-align: left; }
        .ai-result-box th { background-color: #f1f5f9; font-weight: bold; }
        
        /* è¤‡è£½æŒ‰éˆ• */
        .copy-btn { position: absolute; top: 0.5rem; right: 0.5rem; opacity: 0.8; transition: opacity 0.2s; }
        .copy-btn:hover { opacity: 1; }
        
        /* éš±è—/é¡¯ç¤ºå€å¡Šå‹•ç•« */
        .hidden-section { display: none; }
        .fade-in { animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* æ‹–æ”¾å€å¡Šæ¨£å¼ */
        .drop-zone { transition: all 0.3s; background-image: url("data:image/svg+xml,%3csvg width='100%25' height='100%25' xmlns='http://www.w3.org/2000/svg'%3e%3crect width='100%25' height='100%25' fill='none' rx='12' ry='12' stroke='%23CBD5E1FF' stroke-width='2' stroke-dasharray='12%2c 12' stroke-dashoffset='0' stroke-linecap='square'/%3e%3c/svg%3e"); }
        .drop-zone.dragover { background-color: #e0e7ff; border-color: #4338ca; background-image: url("data:image/svg+xml,%3csvg width='100%25' height='100%25' xmlns='http://www.w3.org/2000/svg'%3e%3crect width='100%25' height='100%25' fill='none' rx='12' ry='12' stroke='%234338CAFF' stroke-width='2' stroke-dasharray='12%2c 12' stroke-dashoffset='0' stroke-linecap='square'/%3e%3c/svg%3e"); }

        /* æ»¾å‹•æ¢ç¾åŒ– */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #c7c7c7; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #a0a0a0; }
    </style>
</head>
<body class="flex h-screen overflow-hidden text-gray-800">

    <!-- å·¦å´å°è¦½åˆ— -->
    <aside class="w-20 lg:w-64 bg-white shadow-xl flex flex-col z-20 transition-all duration-300">
        <div class="p-4 lg:p-6 border-b flex items-center justify-center lg:justify-start gap-3 h-20">
            <div class="bg-indigo-600 text-white p-2 rounded-lg">
                <i class="fa-solid fa-graduation-cap text-xl"></i>
            </div>
            <h1 class="font-bold text-xl text-gray-800 hidden lg:block">AI è®€æ›¸æ•™ç·´</h1>
        </div>
        
        <nav class="flex-1 overflow-y-auto py-4 space-y-1">
            <div onclick="switchTab('daily')" id="nav-daily" class="sidebar-item active p-4 flex items-center gap-4 text-gray-600 hover:text-indigo-600">
                <i class="fa-solid fa-calendar-day w-6 text-center text-lg"></i> 
                <span class="hidden lg:block font-medium">æ¯æ—¥è®€æ›¸è¨ˆç•«</span>
            </div>
            <div onclick="switchTab('error')" id="nav-error" class="sidebar-item p-4 flex items-center gap-4 text-gray-600 hover:text-teal-600">
                <i class="fa-solid fa-bug w-6 text-center text-lg"></i> 
                <span class="hidden lg:block font-medium">éŒ¯é¡Œåˆ†æèˆ‡æ¯é€±è¨ˆç•«</span>
            </div>
            <div onclick="switchTab('exam')" id="nav-exam" class="sidebar-item p-4 flex items-center gap-4 text-gray-600 hover:text-orange-600">
                <i class="fa-solid fa-stopwatch w-6 text-center text-lg"></i> 
                <span class="hidden lg:block font-medium">æ®µè€ƒè¡åˆº (7å¤©)</span>
            </div>
            <div onclick="switchTab('review')" id="nav-review" class="sidebar-item p-4 flex items-center gap-4 text-gray-600 hover:text-pink-600">
                <i class="fa-solid fa-magnifying-glass-chart w-6 text-center text-lg"></i> 
                <span class="hidden lg:block font-medium">è€ƒå¾Œ AI æª¢è¨</span>
            </div>
            <div onclick="switchTab('quick')" id="nav-quick" class="sidebar-item p-4 flex items-center gap-4 text-gray-600 hover:text-yellow-600">
                <i class="fa-solid fa-hand-holding-heart w-6 text-center text-lg"></i> 
                <span class="hidden lg:block font-medium">æˆ‘å¯ä»¥è·Ÿä½ ä¸€èµ·å­¸ç¿’</span>
            </div>
        </nav>
        
        <div class="p-4 border-t text-xs text-gray-400 text-center hidden lg:block">
            <button onclick="toggleConfigModal()" class="text-indigo-500 hover:underline mb-2 block w-full text-left">ğŸ”— è¨­å®šå¾Œå°é€£çµ</button>
            <p class="mt-1">Designed for Student Success</p>
            <p class="mt-1">v7.2.0 (Optimized)</p>
        </div>
    </aside>

    <!-- å³å´ä¸»å…§å®¹ -->
    <main class="flex-1 overflow-y-auto bg-gray-50 relative w-full">
        
        <!-- Config Modal -->
        <div id="config-modal" class="fixed inset-0 bg-black/50 z-50 hidden flex items-center justify-center fade-in">
            <div class="bg-white p-6 rounded-xl shadow-2xl w-96 max-w-full m-4">
                <h3 class="text-xl font-bold mb-4 text-gray-800">è¨­å®š Google Apps Script å¾Œå°</h3>
                <p class="text-sm text-gray-600 mb-4">è«‹è²¼ä¸Šéƒ¨ç½²å®Œæˆçš„ Web App URLï¼Œä»¥ä¾¿å°‡å­¸ç¿’è¨˜éŒ„å„²å­˜è‡³ Google è©¦ç®—è¡¨ã€‚</p>
                <input type="text" id="gas-url-input" placeholder="https://script.google.com/macros/s/..." class="w-full p-3 border rounded mb-4 text-sm">
                <div class="flex justify-end gap-2">
                    <button onclick="toggleConfigModal()" class="px-4 py-2 text-gray-600 hover:bg-gray-100 rounded">å–æ¶ˆ</button>
                    <button onclick="saveGasUrl()" class="px-4 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700">å„²å­˜</button>
                </div>
            </div>
        </div>

        <!-- æˆåŠŸè¤‡è£½æç¤º (Toast) -->
        <div id="toast" class="fixed top-6 right-6 bg-emerald-600 text-white px-6 py-4 rounded-lg shadow-2xl transform translate-x-[150%] transition-transform duration-300 z-50 flex items-center gap-3 border-l-4 border-emerald-300">
            <i class="fa-solid fa-circle-check text-xl"></i>
            <div>
                <h4 class="font-bold text-sm">æ“ä½œæˆåŠŸï¼</h4>
                <p class="text-xs text-emerald-100" id="toast-msg">å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿</p>
            </div>
        </div>

        <div class="max-w-4xl mx-auto p-4 lg:p-10 pb-20">
            
            <!-- 1. æ¯æ—¥è®€æ›¸è¨ˆç•« -->
            <section id="daily" class="fade-in">
                <header class="mb-8 border-b pb-4 border-gray-200">
                    <h2 class="text-3xl font-bold text-gray-800 flex items-center gap-3">
                        <span class="bg-indigo-100 text-indigo-600 p-2 rounded-lg"><i class="fa-solid fa-calendar-day"></i></span>
                        æ¯æ—¥è®€æ›¸è¨ˆç•«
                    </h2>
                    <p class="text-gray-500 mt-2 ml-14">è¨­å®šä»Šæ—¥ç›®æ¨™ï¼Œåˆ©ç”¨ AI é€²è¡Œé«˜æ•ˆè¤‡ç¿’èˆ‡åˆ·é¡Œã€‚</p>
                </header>
                
                <!-- åœ–ç‰‡ä¸Šå‚³èˆ‡è‡ªå‹•åˆ¤æ–·å€å¡Š -->
                <div class="bg-white p-6 rounded-xl shadow-sm mb-8 border border-gray-100">
                    <h3 class="font-bold text-lg mb-4 text-gray-700 border-l-4 border-indigo-500 pl-3 flex justify-between items-center">
                        <span>ğŸ¯ ä»Šæ—¥ç›®æ¨™è¨­å®š (åœ–ç‰‡æ™ºæ…§åˆ†æ)</span>
                    </h3>
                    
                    <!-- æ‹–æ”¾å€ (å…¨å¯¬) -->
                    <div id="drop-zone" class="drop-zone w-full h-32 bg-slate-50 rounded-xl flex flex-col items-center justify-center cursor-pointer hover:bg-indigo-50 relative group overflow-hidden mb-6" onclick="document.getElementById('file-input').click()">
                        <input type="file" id="file-input" class="hidden" accept="image/*" multiple onchange="handleFiles(this.files, 'daily')">
                        <div id="drop-zone-text" class="text-center p-4">
                            <i class="fa-solid fa-cloud-arrow-up text-3xl text-gray-400 mb-2 group-hover:text-indigo-500 transition"></i>
                            <p class="text-gray-500 font-medium">æ‹–æ”¾åœ–ç‰‡æˆ–<span class="text-indigo-600 underline">è²¼ä¸Šæˆªåœ–</span> (Ctrl+V)</p>
                            <p class="text-xs text-gray-400 mt-1">æ‰‹æ©Ÿç‰ˆé»æ“Šå³å¯æ‹ç…§ä¸Šå‚³</p>
                        </div>
                        <div id="preview-container" class="absolute inset-0 bg-white/90 hidden flex items-center gap-2 p-2 overflow-x-auto"></div>
                    </div>

                    <!-- åˆ†ææŒ‰éˆ• -->
                    <div class="flex justify-center mb-6">
                        <button onclick="analyzeImagesAndGenerateAll()" class="bg-indigo-600 hover:bg-indigo-700 text-white px-8 py-3 rounded-full shadow-lg flex items-center gap-2 transition transform active:scale-95 disabled:bg-gray-400 disabled:cursor-not-allowed" id="analyze-btn">
                            <i class="fa-solid fa-wand-magic-sparkles"></i> 
                            <span id="analyze-text">AI è‡ªå‹•åˆ¤æ–·ç›®æ¨™ä¸¦ç”Ÿæˆå…§å®¹</span>
                        </button>
                    </div>

                    <!-- çµæœè¼¸å…¥æ¬„ä½ (å–®æ¬„æ’åˆ—) -->
                    <div class="flex flex-col gap-6" id="inputs-container">
                        <div>
                            <label class="block text-sm font-semibold text-gray-600 mb-2">ç§‘ç›®</label>
                            <input type="text" id="daily-subject" placeholder="ä¾‹å¦‚ï¼šé«˜ä¸­æ•¸å­¸" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-300 focus:border-indigo-500 outline-none transition bg-gray-50 focus:bg-white" oninput="updateDailyPrompts()">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-600 mb-2">å–®å…ƒ/ç« ç¯€</label>
                            <input type="text" id="daily-unit" placeholder="ä¾‹å¦‚ï¼šä¸‰è§’å‡½æ•¸" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-300 focus:border-indigo-500 outline-none transition bg-gray-50 focus:bg-white" oninput="updateDailyPrompts()">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-600 mb-2">ä»Šæ—¥æœ€é‡è¦ä»»å‹™</label>
                            <input type="text" id="daily-task" placeholder="ä¾‹å¦‚ï¼šææ‡‚æ­£å¼¦å®šç†çš„æ‡‰ç”¨" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-300 focus:border-indigo-500 outline-none transition bg-gray-50 focus:bg-white" oninput="updateDailyPrompts()">
                        </div>
                    </div>
                </div>

                <div class="flex flex-col gap-8">
                    <!-- AI åœ–åƒå­¸ç¿’åŠ©æ‰‹ Card -->
                    <div class="bg-white rounded-xl shadow-sm card overflow-hidden border border-gray-100">
                        <div class="bg-blue-50 p-4 border-b border-blue-100 flex items-center gap-2">
                            <i class="fa-solid fa-brain text-blue-600"></i>
                            <h3 class="font-bold text-blue-800">AI åœ–åƒå­¸ç¿’åŠ©æ‰‹ (è‡ªå‹•ç”Ÿæˆ)</h3>
                        </div>
                        <div class="p-6 flex flex-col h-full gap-8">
                            <!-- é–ƒå¡å€å¡Š -->
                            <div>
                                <h4 class="font-bold text-gray-700 mb-2 flex items-center gap-2"><i class="fa-solid fa-clone text-blue-500"></i> å­¸ç¿’é–ƒå¡</h4>
                                <div id="ai-flashcards-result" class="min-h-[100px] ai-result-box p-4 rounded text-sm overflow-y-auto max-h-80 border-t-4 border-blue-300 bg-slate-50">
                                    <p class="text-gray-400 text-center mt-4 text-xs">ç­‰å¾…åˆ†æåœ–ç‰‡å¾Œè‡ªå‹•ç”Ÿæˆ...</p>
                                </div>
                            </div>
                            <!-- å¿ƒæ™ºåœ–å€å¡Š -->
                            <div>
                                <h4 class="font-bold text-gray-700 mb-2 flex items-center gap-2"><i class="fa-solid fa-sitemap text-blue-500"></i> å¿ƒæ™ºåœ–çµæ§‹</h4>
                                <div id="ai-mindmap-result" class="min-h-[100px] ai-result-box p-4 rounded text-sm overflow-y-auto max-h-80 border-t-4 border-blue-300 bg-slate-50">
                                    <p class="text-gray-400 text-center mt-4 text-xs">ç­‰å¾…åˆ†æåœ–ç‰‡å¾Œè‡ªå‹•ç”Ÿæˆ...</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Concept Card -->
                    <div class="bg-white rounded-xl shadow-sm card overflow-hidden border border-gray-100">
                        <div class="bg-emerald-50 p-4 border-b border-emerald-100 flex items-center gap-2">
                            <i class="fa-solid fa-robot text-emerald-600"></i>
                            <h3 class="font-bold text-emerald-800">è§€å¿µç†è§£ (è‡ªå‹•è¬›è§£)</h3>
                        </div>
                        <div class="p-6 flex flex-col h-full">
                            <p class="text-sm text-gray-600 mb-4">é‡å° <span class="font-bold text-emerald-600 daily-task-display">____</span> è‡ªå‹•ç”Ÿæˆç™½è©±æ–‡è§£é‡‹èˆ‡ç”Ÿæ´»å¯¦ä¾‹ï¼š</p>
                            <div id="ai-concept-result" class="flex-1 min-h-[250px] ai-result-box p-6 rounded text-sm overflow-y-auto max-h-[600px] border-t-4 border-emerald-400 bg-slate-50">
                                <p class="text-gray-400 text-center mt-10 text-xs">ç­‰å¾…åˆ†æç›®æ¨™å¾Œè‡ªå‹•ç”Ÿæˆ...</p>
                            </div>
                        </div>
                    </div>

                    <!-- Practice Card -->
                    <div class="bg-white rounded-xl shadow-sm card overflow-hidden border border-gray-100">
                        <div class="bg-purple-50 p-4 border-b border-purple-100 flex items-center gap-2">
                            <i class="fa-solid fa-pen-to-square text-purple-600"></i>
                            <h3 class="font-bold text-purple-800">æ¯æ—¥å¿…åšç·´ç¿’ (AI è‡ªå‹•å‡ºé¡Œ)</h3>
                        </div>
                        <div class="p-6 flex flex-col h-full">
                            <p class="text-sm text-gray-600 mb-4">AI å®¶æ•™æ ¹æ“šä»Šæ—¥é€²åº¦è‡ªå‹•å‡ºé¡Œï¼š</p>
                            <div id="ai-quiz-result" class="flex-1 min-h-[300px] ai-result-box p-6 rounded text-sm overflow-y-auto max-h-[600px] border-t-4 border-purple-400 bg-slate-50">
                                <p class="text-gray-400 text-center mt-10 text-xs">ç­‰å¾…åˆ†æç›®æ¨™å¾Œè‡ªå‹•ç”Ÿæˆ 10 é¡Œç·´ç¿’é¡Œ...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 2. éŒ¯é¡Œåˆ†æèˆ‡æ¯é€±è¨ˆç•« -->
            <section id="error" class="hidden-section fade-in">
                <header class="mb-8 border-b pb-4 border-gray-200">
                    <h2 class="text-3xl font-bold text-gray-800 flex items-center gap-3">
                        <span class="bg-teal-600 text-white px-3 py-1 rounded-lg text-2xl"><i class="fa-solid fa-chart-line"></i></span>
                        éŒ¯é¡Œåˆ†æèˆ‡æ¯é€±è¨ˆç•«
                    </h2>
                    <p class="text-gray-500 mt-2 ml-14">ä¸€ç«™å¼å®ŒæˆéŒ¯é¡Œæª¢è¨ã€å­¸ç¿’è¨ºæ–·èˆ‡ä¸‹é€±ç­–ç•¥è¦åŠƒã€‚</p>
                </header>

                <!-- è¼¸å…¥å€ -->
                <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100 mb-8">
                    <h3 class="font-bold text-lg mb-4 text-gray-700 border-l-4 border-teal-500 pl-3 flex justify-between items-center">
                        <span>ğŸ“ éŒ¯é¡Œæ™ºæ…§åˆ†æå€</span>
                        <span class="text-xs text-gray-500 bg-gray-100 px-2 py-1 rounded">æ”¯æ´åœ–ç‰‡ / æ–‡å­—</span>
                    </h3>

                    <!-- æ‹–æ”¾å€ -->
                    <div id="error-drop-zone" class="drop-zone w-full h-32 bg-slate-50 rounded-xl flex flex-col items-center justify-center cursor-pointer hover:bg-teal-50 relative group overflow-hidden border-2 border-dashed border-gray-300" onclick="document.getElementById('error-file-input').click()">
                        <input type="file" id="error-file-input" class="hidden" accept="image/*" multiple onchange="handleFiles(this.files, 'error')">
                        <div id="error-drop-text" class="text-center p-4">
                            <i class="fa-solid fa-camera text-3xl text-gray-400 mb-2 group-hover:text-teal-500 transition"></i>
                            <p class="text-gray-500 font-medium">æ‹–æ”¾éŒ¯é¡Œæˆªåœ–æˆ–<span class="text-teal-600 underline">è²¼ä¸Šåœ–ç‰‡</span> (Ctrl+V)</p>
                            <p class="text-xs text-gray-400 mt-1">é»æ“Šå³å¯ä¸Šå‚³</p>
                        </div>
                        <div id="error-preview-container" class="absolute inset-0 bg-white/90 hidden flex items-center gap-2 p-2 overflow-x-auto"></div>
                    </div>

                    <!-- æ–‡å­—è¼¸å…¥å€ -->
                    <textarea id="error-text-input" class="w-full h-32 mt-6 p-4 border border-gray-300 rounded-xl font-mono text-sm bg-gray-50 focus:ring-2 focus:ring-teal-300 focus:border-teal-500 outline-none transition resize-none" placeholder="æˆ–è€…ç›´æ¥åœ¨æ­¤è¼¸å…¥æ‚¨çš„éŒ¯é¡Œå…§å®¹æˆ–ä½œç­”æƒ…æ³..."></textarea>

                    <!-- åˆ†ææŒ‰éˆ• -->
                    <div class="flex justify-center mt-6">
                        <button onclick="generateFullErrorAnalysis()" class="bg-teal-600 hover:bg-teal-700 text-white px-8 py-3 rounded-full shadow-lg flex items-center gap-2 transition transform active:scale-95" id="btn-full-analysis">
                            <i class="fa-solid fa-rocket"></i> åŸ·è¡Œå…¨æ–¹ä½åˆ†æ (è£œæ•‘+è¨ºæ–·+è¨ˆç•«)
                        </button>
                    </div>
                </div>

                <!-- 1. éŒ¯é¡Œè£œæ•‘å€ -->
                <div class="flex flex-col gap-8">
                    <div class="bg-white rounded-xl shadow-sm card border border-gray-100 overflow-hidden">
                        <div class="bg-red-50 p-4 border-b border-red-100 font-bold text-red-800 flex items-center gap-2">
                            <i class="fa-solid fa-stethoscope"></i> 1. éŒ¯é¡Œè£œæ•‘ (AI éŒ¯é¡Œæ·±åº¦è§£æ & è£œå¼·)
                        </div>
                        <div class="p-6">
                            <div id="ai-remediation-result" class="min-h-[200px] ai-result-box p-6 rounded text-sm overflow-y-auto max-h-[600px] border-t-4 border-red-300 bg-slate-50">
                                <p class="text-gray-400 text-center mt-10 text-xs">ç­‰å¾…åˆ†æ...</p>
                            </div>
                        </div>
                    </div>

                    <!-- 2. å­¸ç¿’è¨ºæ–·å€ -->
                    <div class="bg-white rounded-xl shadow-sm card border border-gray-100 overflow-hidden">
                         <div class="bg-teal-50 p-4 border-b border-teal-100 font-bold text-teal-800 flex items-center gap-2">
                            <i class="fa-solid fa-user-doctor"></i> 2. AI å­¸ç¿’è¨ºæ–· (åŸºæ–¼éŒ¯é¡Œå¾ªç’°)
                        </div>
                        <div class="p-6">
                            <div id="weekly-diagnosis-result" class="min-h-[300px] ai-result-box p-6 rounded text-sm overflow-y-auto max-h-[600px] border-t-4 border-teal-300 bg-slate-50">
                                <p class="text-gray-400 text-center mt-10 text-xs">ç­‰å¾…åˆ†æ...</p>
                            </div>
                        </div>
                    </div>

                    <!-- 3. ä¸‹é€±ç­–ç•¥å€ -->
                    <div class="bg-white rounded-xl shadow-sm card border border-gray-100 overflow-hidden">
                        <div class="bg-blue-50 p-4 border-b border-blue-100 font-bold text-blue-800 flex items-center gap-2">
                            <i class="fa-solid fa-route"></i> 3. ä¸‹é€± 5 å¤©è®€æ›¸ç­–ç•¥
                        </div>
                        <div class="p-6">
                            <div id="weekly-strategy-result" class="min-h-[300px] ai-result-box p-6 rounded text-sm overflow-y-auto max-h-[600px] border-t-4 border-blue-300 bg-slate-50">
                                <p class="text-gray-400 text-center mt-10 text-xs">ç­‰å¾…åˆ†æ...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 4. æ®µè€ƒè¡åˆº -->
            <section id="exam" class="hidden-section fade-in">
                <header class="mb-8 border-b pb-4 border-gray-200">
                    <h2 class="text-3xl font-bold text-gray-800 flex items-center gap-3">
                        <span class="bg-orange-100 text-orange-600 p-2 rounded-lg"><i class="fa-solid fa-stopwatch"></i></span>
                        æ®µè€ƒå‰ 7 å¤©è¡åˆº
                    </h2>
                    <p class="text-gray-500 mt-2 ml-14">é›†ä¸­ç«åŠ›ï¼Œé‡å°è€ƒé»èˆ‡å¼±é …é€²è¡Œæœ€å¾Œè¡åˆºã€‚</p>
                </header>
                
                <div class="bg-white p-6 rounded-xl shadow-sm mb-8 border border-gray-100">
                     <h3 class="font-bold text-lg mb-4 text-gray-700 border-l-4 border-orange-500 pl-3">ğŸ’ª æˆ‘è¦å†åŠªåŠ›ä¸€ä¸‹</h3>
                     <p class="text-sm text-gray-500 mb-2">å»¶çºŒæ¯é€±è®€æ›¸è¨ˆç•«çš„è¨ºæ–·çµæœï¼Œé‡å°å¼±é»é€²è¡Œè¡åˆºã€‚</p>
                     
                     <div id="exam-diagnosis-ref" class="min-h-[150px] ai-result-box p-6 rounded text-sm overflow-y-auto max-h-[300px] border-t-4 border-orange-300 bg-orange-50/30">
                        <p class="text-gray-400 text-center mt-6 text-xs">è«‹å…ˆå®Œæˆã€ŒéŒ¯é¡Œåˆ†æèˆ‡æ¯é€±è¨ˆç•«ã€ä¸­çš„å­¸ç¿’è¨ºæ–·ï¼Œå…§å®¹å°‡è‡ªå‹•åŒæ­¥è‡³æ­¤ã€‚</p>
                    </div>
                </div>

                <div class="flex flex-col gap-8">
                    <!-- NotebookLM è€ƒé»åœ°åœ– -->
                    <div class="bg-white rounded-xl shadow-sm card border-l-4 border-blue-500 overflow-hidden">
                        <div class="p-6">
                            <h3 class="font-bold text-lg mb-4 text-gray-800">ğŸ§­ NotebookLM è€ƒé»åœ°åœ– (è‡ªå‹•ç”Ÿæˆ)</h3>
                            
                            <!-- æ‹–æ”¾å€ -->
                            <div id="exam-drop-zone" class="drop-zone h-40 bg-slate-50 rounded-xl flex flex-col items-center justify-center cursor-pointer hover:bg-blue-50 relative group overflow-hidden border-2 border-dashed border-gray-300 mb-6" onclick="document.getElementById('exam-file-input').click()">
                                <input type="file" id="exam-file-input" class="hidden" accept="image/*" multiple onchange="handleFiles(this.files, 'exam')">
                                <div id="exam-drop-text" class="text-center p-4">
                                    <i class="fa-solid fa-book-open text-3xl text-gray-400 mb-2 group-hover:text-blue-500 transition"></i>
                                    <p class="text-gray-500 font-medium">ä¸Šå‚³è¬›ç¾©/èª²æœ¬/ç­†è¨˜åœ–ç‰‡</p>
                                    <p class="text-xs text-gray-400 mt-1">æ‹–æ”¾æˆ–è²¼ä¸Šæˆªåœ–</p>
                                </div>
                                <div id="exam-preview-container" class="absolute inset-0 bg-white/90 hidden flex items-center gap-2 p-2 overflow-x-auto"></div>
                            </div>

                            <!-- ç”ŸæˆæŒ‰éˆ• -->
                            <div class="flex justify-center mb-6">
                                <button onclick="generateExamMap()" class="bg-blue-600 hover:bg-blue-700 text-white px-8 py-3 rounded-full shadow-md flex items-center justify-center gap-2 transition transform active:scale-95">
                                    <i class="fa-solid fa-map-location-dot"></i> ç”Ÿæˆè€ƒé»åœ°åœ–
                                </button>
                            </div>

                            <!-- çµæœé¡¯ç¤ºå€ -->
                            <div id="ai-exam-map-result" class="hidden min-h-[200px] ai-result-box p-6 rounded text-sm overflow-y-auto max-h-[500px] border-t-4 border-blue-300 bg-slate-50">
                                <!-- AI Content -->
                            </div>
                        </div>
                    </div>

                    <!-- 7 Day Plan -->
                    <div class="bg-white rounded-xl shadow-sm card border-l-4 border-orange-500 overflow-hidden">
                        <div class="p-6">
                            <h3 class="font-bold text-lg mb-2 text-gray-800">ğŸ“… é»ƒé‡‘è¤‡ç¿’è¨ˆç•« (è‡ªå‹•é€£å‹•)</h3>
                            <div id="ai-exam-plan-result" class="min-h-[300px] ai-result-box p-6 rounded text-sm overflow-y-auto max-h-[600px] border-t-4 border-orange-300 bg-slate-50">
                                <p class="text-gray-400 text-center mt-10 text-xs">ç­‰å¾…è€ƒé»åœ°åœ–ç”Ÿæˆå¾Œï¼Œè‡ªå‹•è¦åŠƒ 7 å¤©è¡åˆºè¡¨...</p>
                            </div>
                        </div>
                    </div>

                    <!-- Mock Exam -->
                    <div class="bg-white rounded-xl shadow-sm card border-l-4 border-red-500 overflow-hidden">
                        <div class="p-6">
                            <h3 class="font-bold text-lg mb-2 text-gray-800">ğŸ“ æ®µè€ƒæ¨¡æ“¬è©¦å· (è‡ªå‹•é€£å‹•)</h3>
                            <div id="ai-mock-exam-result" class="min-h-[300px] ai-result-box p-6 rounded text-sm overflow-y-auto max-h-[600px] border-t-4 border-red-300 bg-slate-50">
                                <p class="text-gray-400 text-center mt-10 text-xs">ç­‰å¾…è€ƒé»åœ°åœ–ç”Ÿæˆå¾Œï¼Œè‡ªå‹•å‡ºé¡Œ...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 5. è€ƒå¾Œæª¢è¨ -->
            <section id="review" class="hidden-section fade-in">
                <header class="mb-8 border-b pb-4 border-gray-200">
                    <h2 class="text-3xl font-bold text-gray-800 flex items-center gap-3">
                        <span class="bg-pink-100 text-pink-600 p-2 rounded-lg"><i class="fa-solid fa-magnifying-glass-chart"></i></span>
                        è€ƒå¾Œ AI æª¢è¨
                    </h2>
                    <p class="text-gray-500 mt-2 ml-14">è€ƒå®Œè©¦ä¸æ˜¯çµæŸï¼Œè€Œæ˜¯æŠ“å‡ºè¿·æ€æ¦‚å¿µçš„æœ€ä½³æ™‚æ©Ÿã€‚</p>
                </header>
                
                <div class="bg-white p-6 rounded-xl shadow-sm mb-8 border border-gray-100">
                    <h3 class="font-bold text-lg mb-4 text-gray-700 border-l-4 border-pink-500 pl-3 flex justify-between items-center">
                        <span>ğŸ“¸ ä¸Šå‚³è€ƒå·éŒ¯é¡Œ (åœ–ç‰‡æ™ºæ…§åˆ†æ)</span>
                    </h3>
                    
                    <div id="review-drop-zone" class="drop-zone w-full h-40 bg-slate-50 rounded-xl flex flex-col items-center justify-center cursor-pointer hover:bg-pink-50 relative group overflow-hidden border-2 border-dashed border-gray-300 mb-6" onclick="document.getElementById('review-file-input').click()">
                        <input type="file" id="review-file-input" class="hidden" accept="image/*" multiple onchange="handleFiles(this.files, 'review')">
                        <div id="review-drop-text" class="text-center p-4">
                            <i class="fa-solid fa-file-circle-xmark text-3xl text-gray-400 mb-2 group-hover:text-pink-500 transition"></i>
                            <p class="text-gray-500 font-medium">è²¼ä¸ŠéŒ¯é¡Œæˆªåœ– (Ctrl+V) æˆ– é»æ“Šä¸Šå‚³</p>
                        </div>
                        <div id="review-preview-container" class="absolute inset-0 bg-white/90 hidden flex items-center gap-2 p-2 overflow-x-auto"></div>
                    </div>

                    <div class="flex justify-center mb-6">
                        <button onclick="analyzeReviewImages()" class="bg-pink-600 hover:bg-pink-700 text-white px-8 py-3 rounded-full shadow-lg flex items-center gap-2 transition transform active:scale-95">
                            <i class="fa-solid fa-microscope"></i> é–‹å§‹æ·±åº¦æª¢è¨
                        </button>
                    </div>
                </div>

                <div class="bg-white rounded-xl shadow-sm card overflow-hidden border border-gray-100">
                    <div class="bg-pink-50 p-4 border-b border-pink-100 font-bold text-pink-800 flex items-center gap-2">
                         <i class="fa-solid fa-clipboard-check"></i> ğŸ” æ·±åº¦æª¢è¨èˆ‡è£œæ•‘
                    </div>
                    <div class="p-6">
                        <div id="ai-review-analysis-result" class="min-h-[400px] ai-result-box p-6 rounded text-sm overflow-y-auto max-h-[800px] border-t-4 border-pink-300 bg-slate-50">
                            <p class="text-gray-400 text-center mt-20 text-xs">
                                <i class="fa-solid fa-arrow-up text-lg mb-2 block"></i>
                                è«‹ä¸Šå‚³éŒ¯é¡Œåœ–ç‰‡ä¸¦é»æ“Šåˆ†æï¼ŒAI å°‡ç‚ºæ‚¨ç”Ÿæˆå®Œæ•´çš„è£œæ•‘æ–¹æ¡ˆã€‚
                            </p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 6. æˆ‘å¯ä»¥è·Ÿä½ ä¸€èµ·å­¸ç¿’ -->
            <section id="quick" class="hidden-section fade-in">
                <header class="mb-8 border-b pb-4 border-gray-200">
                    <h2 class="text-3xl font-bold text-gray-800 flex items-center gap-3">
                        <span class="bg-yellow-100 text-yellow-600 p-2 rounded-lg"><i class="fa-solid fa-hand-holding-heart"></i></span>
                        æˆ‘å¯ä»¥è·Ÿä½ ä¸€èµ·å­¸ç¿’
                    </h2>
                    <p class="text-gray-500 mt-2 ml-14">ä½ çš„å€‹äºº AI å­¸ç¿’å¤¥ä¼´ï¼Œéš¨æ™‚ç‚ºä½ è§£æƒ‘ä¸¦æ•´ç†å­¸ç¿’æ­·ç¨‹ã€‚</p>
                </header>

                <!-- æˆ‘æƒ³å•ä¸€ä¸‹ -->
                <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100 mb-8">
                    <h3 class="font-bold text-lg mb-4 text-gray-700 border-l-4 border-yellow-500 pl-3">
                        ğŸ™‹ æˆ‘æƒ³å•ä¸€ä¸‹
                    </h3>
                    
                    <div class="relative">
                        <textarea id="ask-ai-input" class="w-full h-32 p-4 border border-gray-300 rounded-xl font-mono text-sm bg-yellow-50 focus:ring-2 focus:ring-yellow-300 focus:border-yellow-500 outline-none transition resize-none" placeholder="ä¾‹å¦‚ï¼šå‰›æ‰ç”Ÿæˆçš„éŒ¯é¡Œè§£æä¸­ï¼Œç¬¬ä¸‰é¡Œçš„è§€å¿µæˆ‘é‚„æ˜¯ä¸å¤ªæ‡‚..."></textarea>
                        <div class="absolute bottom-3 right-3">
                            <button onclick="askAI()" id="btn-ask-ai" class="bg-yellow-500 hover:bg-yellow-600 text-white px-4 py-2 rounded-lg shadow-sm text-sm flex items-center gap-2 transition">
                                <i class="fa-solid fa-paper-plane"></i> ç™¼é€å•é¡Œ
                            </button>
                        </div>
                    </div>

                    <!-- AI å›ç­”å€ -->
                    <div id="ai-chat-response" class="hidden mt-4 min-h-[100px] ai-result-box p-6 rounded-xl text-sm border-t-4 border-yellow-300 bg-white shadow-inner"></div>
                </div>

                <!-- å­¸ç¿’æ­·ç¨‹å½™æ•´ -->
                <div class="bg-white rounded-xl shadow-sm card overflow-hidden border border-gray-100 mb-8">
                    <div class="bg-gray-50 p-4 border-b border-gray-200 font-bold text-gray-700 flex items-center gap-2 justify-between">
                        <span class="flex items-center gap-2"><i class="fa-solid fa-folder-open"></i> ğŸ“š å­¸ç¿’æ­·ç¨‹å½™æ•´ (æœ¬æ¬¡ç”Ÿæˆå…§å®¹)</span>
                        <button onclick="saveDataToBackend()" class="text-xs bg-indigo-600 text-white px-3 py-1 rounded hover:bg-indigo-700 transition flex items-center gap-1">
                            <i class="fa-solid fa-cloud-arrow-up"></i> ä¸Šå‚³è‡³é›²ç«¯è©¦ç®—è¡¨
                        </button>
                    </div>
                    <div class="p-6 bg-slate-50">
                        <div id="summary-container" class="flex flex-col gap-6">
                            <p class="text-gray-400 text-center py-10 text-sm">ç›®å‰é‚„æ²’æœ‰ç”Ÿæˆçš„å…§å®¹ï¼Œå¿«å»å…¶ä»–é é¢é–‹å§‹å­¸ç¿’å§ï¼</p>
                        </div>
                        <div class="mt-6 text-center">
                            <button onclick="renderSummary()" class="text-indigo-600 text-sm hover:underline"><i class="fa-solid fa-rotate"></i> åˆ·æ–°å½™æ•´å…§å®¹</button>
                        </div>
                    </div>
                </div>

                <!-- å­¸ç¿’æ•¸æ“šå„€è¡¨æ¿ -->
                <div class="bg-white rounded-xl shadow-sm card overflow-hidden border border-gray-100">
                    <div class="bg-gray-50 p-4 border-b border-gray-200 font-bold text-gray-700 flex items-center gap-2">
                        <i class="fa-solid fa-chart-pie"></i> ğŸ“Š å­¸ç¿’æ•¸æ“šå„€è¡¨æ¿
                    </div>
                    <div class="p-6 flex flex-col gap-8">
                        <div>
                            <h4 class="text-sm font-bold text-gray-600 mb-4 text-center">èƒ½åŠ›èˆ‡æ´»å‹•é›·é”åˆ†æ</h4>
                            <div class="relative h-64 w-full">
                                <canvas id="radarChart"></canvas>
                            </div>
                        </div>
                        <div>
                            <h4 class="text-sm font-bold text-gray-600 mb-4 text-center">å­¸ç¿’ç´¯ç©ç”¢å‡ºé‡</h4>
                            <div class="relative h-64 w-full">
                                <canvas id="barChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

        </div>
    </main>

    <script>
        const userApiKey = 'AIzaSyDmsZTY4Quo2LsalDSR-9Yjg-KslSJr27o'; 
        let gasWebAppUrl = 'https://script.google.com/macros/s/AKfycbwygx2nxTGV8J2KuL9baN4xyhoi64jLEzhD4dKCfuwB0d_x97T6hR_AQgriV9rjuiFK/exec'; // Hardcoded GAS URL

        let uploadedImages = []; 
        let errorUploadedImages = []; 
        let examUploadedImages = []; 
        let reviewUploadedImages = []; 
        
        let lastWeeklyDiagnosis = ""; 
        let lastExamMapResult = ""; 

        // Learning Stats Tracking
        const learningStats = {
            daily: 0,
            error: 0,
            exam: 0,
            review: 0,
            flashcards_count: 0,
            questions_count: 0,
            plans_count: 0
        };

        let radarChart = null;
        let barChart = null;

        // Config Modal Logic (Simplified as hardcoded)
        function toggleConfigModal() {
            alert("å¾Œå°é€£çµå·²ç›´æ¥è¨­å®šæ–¼ç¨‹å¼ç¢¼ä¸­ï¼š\n" + gasWebAppUrl);
        }

        function saveGasUrl() {
            // No-op for hardcoded version
        }

        // --- Data Sending Logic ---
        async function saveDataToBackend() {
            if(!gasWebAppUrl) {
                alert("è«‹å…ˆè¨­å®šå¾Œå°é€£çµ (Web App URL)ï¼");
                return;
            }

            const summaryHTML = document.getElementById('summary-container').innerText;
            const dataPayload = {
                type: 'å­¸ç¿’å½™æ•´',
                topic: 'ç¶œåˆå­¸ç¿’è¨˜éŒ„',
                content: summaryHTML.substring(0, 5000), 
                stats: learningStats
            };

            try {
                await fetch(gasWebAppUrl, {
                    method: 'POST',
                    mode: 'no-cors', 
                    headers: { 'Content-Type': 'text/plain' },
                    body: JSON.stringify(dataPayload)
                });
                alert("è³‡æ–™å·²å‚³é€è‡³å¾Œå°ï¼(è«‹æª¢æŸ¥æ‚¨çš„ Google è©¦ç®—è¡¨)");
            } catch (error) {
                console.error(error);
                alert("å‚³é€å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²å€æˆ–ç¶²è·¯é€£ç·šã€‚");
            }
        }

        // Tab Switching Logic
        function switchTab(tabId) {
            document.querySelectorAll('section').forEach(el => el.classList.add('hidden-section'));
            document.getElementById(tabId).classList.remove('hidden-section');
            
            document.querySelectorAll('.sidebar-item').forEach(el => el.classList.remove('active', 'bg-indigo-50', 'text-indigo-700', 'border-l-4', 'border-indigo-600', 'text-gray-900'));
            const navItem = document.getElementById('nav-' + tabId);
            navItem.classList.add('active');
            
            if(tabId === 'exam') {
                const diagRef = document.getElementById('exam-diagnosis-ref');
                if(lastWeeklyDiagnosis) {
                    diagRef.innerHTML = `
                        <div class="font-bold text-orange-800 mb-2"><i class="fa-solid fa-link"></i> ä¾†è‡ªéŒ¯é¡Œåˆ†æçš„è¨ºæ–·ï¼š</div>
                        ${marked.parse(lastWeeklyDiagnosis)}
                    `;
                }
            } else if (tabId === 'quick') {
                renderSummary();
                updateCharts(); 
            }

            document.querySelector('main').scrollTop = 0;
        }

        // --- Chart.js Logic ---
        function updateCharts() {
            const ctxRadar = document.getElementById('radarChart').getContext('2d');
            const ctxBar = document.getElementById('barChart').getContext('2d');

            if(radarChart) radarChart.destroy();
            if(barChart) barChart.destroy();

            radarChart = new Chart(ctxRadar, {
                type: 'radar',
                data: {
                    labels: ['æ¯æ—¥å­¸ç¿’', 'éŒ¯é¡Œè£œæ•‘', 'æ®µè€ƒè¡åˆº', 'è€ƒå¾Œæª¢è¨'],
                    datasets: [{
                        label: 'æŠ•å…¥å¼·åº¦',
                        data: [learningStats.daily, learningStats.error, learningStats.exam, learningStats.review],
                        fill: true,
                        backgroundColor: 'rgba(99, 102, 241, 0.2)',
                        borderColor: 'rgb(99, 102, 241)',
                        pointBackgroundColor: 'rgb(99, 102, 241)',
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: 'rgb(99, 102, 241)'
                    }]
                },
                options: {
                    scales: {
                        r: {
                            angleLines: { display: false },
                            suggestedMin: 0,
                            suggestedMax: 5 
                        }
                    },
                    responsive: true,
                    maintainAspectRatio: false
                }
            });

            barChart = new Chart(ctxBar, {
                type: 'bar',
                data: {
                    labels: ['å­¸ç¿’é–ƒå¡ (å¼µ)', 'ç·´ç¿’é¡Œç›® (é¡Œ)', 'ç”Ÿæˆè¨ˆç•« (ä»½)'],
                    datasets: [{
                        label: 'ç´¯è¨ˆæ•¸é‡',
                        data: [learningStats.flashcards_count, learningStats.questions_count, learningStats.plans_count],
                        backgroundColor: [
                            'rgba(255, 99, 132, 0.6)',
                            'rgba(54, 162, 235, 0.6)',
                            'rgba(255, 206, 86, 0.6)'
                        ],
                        borderColor: [
                            'rgb(255, 99, 132)',
                            'rgb(54, 162, 235)',
                            'rgb(255, 206, 86)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    scales: { y: { beginAtZero: true, ticks: { precision: 0 } } },
                    responsive: true,
                    maintainAspectRatio: false
                }
            });
        }

        // --- Image Handling Logic ---
        function setupDropZone(dropZoneId, fileInputId, previewId, textId, type) {
            const dropZone = document.getElementById(dropZoneId);
            
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                dropZone.addEventListener(eventName, preventDefaults, false);
            });
            ['dragenter', 'dragover'].forEach(eventName => {
                dropZone.addEventListener(eventName, () => dropZone.classList.add('dragover'), false);
            });
            ['dragleave', 'drop'].forEach(eventName => {
                dropZone.addEventListener(eventName, () => dropZone.classList.remove('dragover'), false);
            });
            dropZone.addEventListener('drop', (e) => handleFiles(e.dataTransfer.files, type), false);
        }

        function preventDefaults(e) { e.preventDefault(); e.stopPropagation(); }

        setupDropZone('drop-zone', 'file-input', 'preview-container', 'drop-zone-text', 'daily');
        setupDropZone('error-drop-zone', 'error-file-input', 'error-preview-container', 'error-drop-text', 'error');
        setupDropZone('exam-drop-zone', 'exam-file-input', 'exam-preview-container', 'exam-drop-text', 'exam');
        setupDropZone('review-drop-zone', 'review-file-input', 'review-preview-container', 'review-drop-text', 'review');

        window.addEventListener('paste', (e) => {
            const sections = ['daily', 'error', 'exam', 'review'];
            let targetType = null;
            for(const sec of sections) {
                if(!document.getElementById(sec).classList.contains('hidden-section')) {
                    targetType = sec; break;
                }
            }
            if(!targetType) return;
            const items = (e.clipboardData || e.originalEvent.clipboardData).items;
            const files = [];
            for (let index in items) {
                if (items[index].kind === 'file') files.push(items[index].getAsFile());
            }
            if (files.length > 0) handleFiles(files, targetType);
        });

        function handleFiles(files, type) {
            const filesArray = [...files];
            let targetArray, previewContainer, textId;

            if(type === 'daily') { targetArray = uploadedImages; previewContainer = document.getElementById('preview-container'); textId = 'drop-zone-text'; }
            else if(type === 'error') { targetArray = errorUploadedImages; previewContainer = document.getElementById('error-preview-container'); textId = 'error-drop-text'; }
            else if(type === 'exam') { targetArray = examUploadedImages; previewContainer = document.getElementById('exam-preview-container'); textId = 'exam-drop-text'; }
            else if(type === 'review') { targetArray = reviewUploadedImages; previewContainer = document.getElementById('review-preview-container'); textId = 'review-drop-text'; }

            filesArray.forEach(file => {
                if (file.type.startsWith('image/')) {
                    const reader = new FileReader();
                    reader.readAsDataURL(file);
                    reader.onloadend = function() {
                        const base64data = reader.result;
                        targetArray.push(base64data);
                        const img = document.createElement('img');
                        img.src = base64data;
                        img.className = "h-full w-auto rounded shadow-sm border border-gray-200 object-cover";
                        previewContainer.appendChild(img);
                        previewContainer.classList.remove('hidden');
                        document.getElementById(textId).classList.add('opacity-0');
                    }
                }
            });
        }

        // --- Gemini API Call Helper ---
        async function callGemini(prompt, images = []) {
            try {
                const imageParts = images.map(base64 => ({
                    inlineData: {
                        mimeType: "image/jpeg",
                        data: base64.split(',')[1]
                    }
                }));
                const payload = { contents: [{ parts: [{ text: prompt }, ...imageParts] }] };
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${userApiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                const data = await response.json();
                if (data.error) throw new Error(data.error.message);
                return data.candidates[0].content.parts[0].text;
            } catch (error) {
                console.error("Gemini API Error:", error);
                throw error;
            }
        }

        // --- Helper UI ---
        function setLoading(elementId, text) {
            const el = document.getElementById(elementId);
            el.classList.remove('hidden');
            el.innerHTML = `<div class="flex items-center justify-center gap-2 text-gray-500 h-full min-h-[50px]"><i class="fa-solid fa-spinner fa-spin"></i> ${text}</div>`;
        }
        function setError(elementId, msg) {
            const el = document.getElementById(elementId);
            el.classList.remove('hidden');
            el.innerHTML = `<div class="text-red-500 p-2"><i class="fa-solid fa-triangle-exclamation"></i> ${msg}</div>`;
        }

        // --- Daily Plan Logic ---
        async function analyzeImagesAndGenerateAll() {
            if (uploadedImages.length === 0) { alert("è«‹å…ˆä¸Šå‚³æˆ–è²¼ä¸Šåœ–ç‰‡ï¼"); return; }
            const btn = document.getElementById('analyze-btn');
            const originalText = document.getElementById('analyze-text').innerText;
            btn.disabled = true;
            document.getElementById('analyze-text').innerText = "AI æ­£åœ¨å…¨é¢åˆ†æèˆ‡ç”Ÿæˆä¸­...";
            btn.classList.add('animate-pulse');

            setLoading('ai-flashcards-result', 'æ­£åœ¨ç”Ÿæˆå­¸ç¿’é–ƒå¡...');
            setLoading('ai-mindmap-result', 'æ­£åœ¨å»ºæ§‹å¿ƒæ™ºåœ–...');
            setLoading('ai-concept-result', 'æ­£åœ¨ç”Ÿæˆè§€å¿µè¬›è§£...');
            setLoading('ai-quiz-result', 'æ­£åœ¨è¨­è¨ˆ 10 é¡Œç·´ç¿’é¡Œ...');

            try {
                const analysisPrompt = "è«‹åˆ†æé€™å¼µåœ–ç‰‡å…§å®¹ï¼Œåˆ¤æ–·é©åˆçš„è®€æ›¸è¨ˆç•«ã€‚è«‹æå–ï¼š1.ç§‘ç›®(Subject) 2.å–®å…ƒ/ç« ç¯€(Unit) 3.ä»Šæ—¥æœ€é‡è¦çš„å­¸ç¿’ä»»å‹™(Task)ã€‚è«‹ç›´æ¥å›å‚³ JSON æ ¼å¼ï¼Œkey ç‚º subject, unit, taskã€‚ä¸è¦å›å‚³ markdown æ ¼å¼ã€‚";
                const analysisResultText = await callGemini(analysisPrompt, uploadedImages);
                let cleanJson = analysisResultText.trim();
                // Extract JSON if wrapped in markdown code blocks
                const jsonMatch = cleanJson.match(/```json\s*([\s\S]*?)\s*```/) || cleanJson.match(/```\s*([\s\S]*?)\s*```/);
                if (jsonMatch) {
                    cleanJson = jsonMatch[1];
                }
                const analysisResult = JSON.parse(cleanJson);

                if (analysisResult.subject) document.getElementById('daily-subject').value = analysisResult.subject;
                if (analysisResult.unit) document.getElementById('daily-unit').value = analysisResult.unit;
                if (analysisResult.task) document.getElementById('daily-task').value = analysisResult.task;
                updateDailyPrompts();

                const task = analysisResult.task || analysisResult.unit || "é€™å€‹å–®å…ƒ";
                const subject = analysisResult.subject || "";
                const unit = analysisResult.unit || "";

                // Increment Stats
                learningStats.daily += 1; 

                generateFlashcards();
                generateMindmap();
                generateConceptExplanation(task);
                generateDailyQuiz(subject, unit);

                showToast("ç›®æ¨™åˆ†æå®Œæˆï¼Œæ­£åœ¨ç”Ÿæˆå…§å®¹...");
            } catch (error) { alert("åˆ†æå¤±æ•—ï¼š" + error.message); } 
            finally {
                btn.disabled = false;
                document.getElementById('analyze-text').innerText = originalText;
                btn.classList.remove('animate-pulse');
            }
        }

        async function generateFlashcards() {
            try {
                const prompt = "è«‹ä»”ç´°é–±è®€åœ–ç‰‡ä¸­çš„å…§å®¹ï¼Œç‚ºæˆ‘ç”Ÿæˆ 5-10 å¼µé«˜æ•ˆå­¸ç¿’é–ƒå¡ã€‚è«‹ä½¿ç”¨ Markdown æ ¼å¼ï¼ŒåŒ…å«å•é¡Œ (Q) å’Œè©³ç´°ç­”æ¡ˆ (A)ã€‚";
                const text = await callGemini(prompt, uploadedImages);
                document.getElementById('ai-flashcards-result').innerHTML = marked.parse(text);
                learningStats.flashcards_count += 10; // Estimation
            } catch (error) { setError('ai-flashcards-result', error.message); }
        }

        async function generateMindmap() {
            try {
                const prompt = "è«‹ä»”ç´°é–±è®€åœ–ç‰‡ä¸­çš„å…§å®¹ï¼Œæ­¸ç´é‡é»ä¸¦æ•´ç†æˆä¸€å€‹çµæ§‹æ¸…æ™°çš„å¿ƒæ™ºåœ–ã€‚è«‹ä½¿ç”¨ Markdown çš„ç¸®æ’åˆ—è¡¨æ ¼å¼ ( - ) ä¾†å‘ˆç¾å±¤ç´šé—œä¿‚ã€‚";
                const text = await callGemini(prompt, uploadedImages);
                document.getElementById('ai-mindmap-result').innerHTML = marked.parse(text);
            } catch (error) { setError('ai-mindmap-result', error.message); }
        }

        async function generateConceptExplanation(task) {
            try {
                const prompt = `è«‹é‡å°å­¸ç¿’ä»»å‹™ã€Œ${task}ã€ï¼Œç”¨ç™½è©±æ–‡è§£é‡‹é€™æ˜¯ä»€éº¼ï¼Œä¸¦èˆ‰å‡º 2 å€‹ç”Ÿæ´»ä¸­çš„ä¾‹å­ä¾†å¹«åŠ©ç†è§£ã€‚è«‹ä½¿ç”¨ Markdown æ ¼å¼è¼¸å‡ºã€‚`;
                const text = await callGemini(prompt, uploadedImages.length > 0 ? uploadedImages : []); 
                document.getElementById('ai-concept-result').innerHTML = marked.parse(text);
            } catch (error) { setError('ai-concept-result', error.message); }
        }

        async function generateDailyQuiz(subject, unit) {
            try {
                const target = `${subject} ${unit}`.trim() || "ä¸Šå‚³çš„å…§å®¹";
                const prompt = `è«‹ä½ ç•¶æˆ‘çš„éš¨èº«å®¶æ•™ï¼Œæ ¹æ“šæˆ‘ä»Šå¤©è®€çš„ã€${target}ã€‘ï¼Œå‡º 10 é¡Œã€Œç›¸å°æˆ‘ç›®å‰ç¨‹åº¦ã€çš„é¡Œç›®ã€‚æ¯é¡Œéƒ½è¦é™„è§£æã€‚`;
                const text = await callGemini(prompt, uploadedImages);
                document.getElementById('ai-quiz-result').innerHTML = marked.parse(text);
                learningStats.questions_count += 10;
            } catch (error) { setError('ai-quiz-result', error.message); }
        }

        // --- Error Analysis Logic ---
        async function generateFullErrorAnalysis() {
            const userText = document.getElementById('error-text-input').value;
            if (errorUploadedImages.length === 0 && !userText.trim()) { alert("è«‹å…ˆè²¼ä¸ŠéŒ¯é¡Œæˆªåœ–æˆ–è¼¸å…¥æ–‡å­—ï¼"); return; }

            const btn = document.getElementById('btn-full-analysis');
            btn.disabled = true; btn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> æ­£åœ¨å…¨é€Ÿåˆ†æä¸­...';
            setLoading('ai-remediation-result', 'AI æ­£åœ¨åˆ†æ...');
            setLoading('weekly-diagnosis-result', 'æ­£åœ¨è¨ºæ–·...');
            setLoading('weekly-strategy-result', 'æ­£åœ¨è¦åŠƒ...');

            try {
                learningStats.error += 1; // Stat update

                const contextPrompt = `æˆ‘ä¸Šå‚³äº†éŒ¯é¡Œçš„åœ–ç‰‡æˆ–æ–‡å­—æè¿°ã€‚\næ–‡å­—æè¿°ï¼š${userText}\n\n`;
                const remediationPrompt = `${contextPrompt} è«‹å¹«æˆ‘é€²è¡ŒéŒ¯é¡Œè£œæ•‘ï¼š\n1. åˆ†æé€™é“é¡Œç›®èƒŒå¾Œçš„æ ¸å¿ƒè§€å¿µèˆ‡è€ƒé»ã€‚\n2. ç›´æ¥å‡º 3 é¡Œã€Œç›¸åŒé¡Œå‹ã€çš„é¡é¡Œä¾›æˆ‘ç·´ç¿’ã€‚\n3. æ¯é¡Œé™„ä¸Šæ­£ç¢ºç­”æ¡ˆèˆ‡ç°¡çŸ­è§£æã€‚\nè«‹ä½¿ç”¨ Markdown æ ¼å¼è¼¸å‡ºã€‚`;
                
                const remediationText = await callGemini(remediationPrompt, errorUploadedImages);
                document.getElementById('ai-remediation-result').innerHTML = marked.parse(remediationText);
                learningStats.questions_count += 3;

                const diagnosisPrompt = `${contextPrompt} åŸºæ–¼æˆ‘çš„éŒ¯é¡Œä»¥åŠå‰›æ‰çš„è£œæ•‘åˆ†æï¼š\n${remediationText.substring(0, 500)}...\n\nè«‹å¹«æˆ‘æ·±åº¦åˆ†ææˆ‘çš„å­¸ç¿’ç›²é»ã€‚è«‹å…·é«”æŒ‡å‡ºæˆ‘å“ªå€‹è§€å¿µè–„å¼±ï¼Œæˆ–æ˜¯å“ªç¨®é¡Œå‹å®¹æ˜“å‡ºéŒ¯ã€‚è«‹ç”¨ Markdown æ¢åˆ—å¼è¼¸å‡ºã€‚`;
                const diagnosisText = await callGemini(diagnosisPrompt, errorUploadedImages);
                lastWeeklyDiagnosis = diagnosisText;
                document.getElementById('weekly-diagnosis-result').innerHTML = marked.parse(diagnosisText);

                const strategyPrompt = `åŸºæ–¼ä»¥ä¸‹çš„å­¸ç¿’ç›²é»åˆ†æï¼š\n${diagnosisText}\n\nè«‹ä¾ç…§æˆ‘çš„å¼±é»ï¼Œæ›¿æˆ‘åˆ¶å®šä¸‹é€±çš„ 5 å¤©è®€æ›¸è¨ˆç•«ã€‚\néœ€åŒ…å«ï¼šæ¯æ—¥é‡é»ã€é¡Œç›®æ•¸é‡ã€è§€å¿µ/é¡Œå‹çš„é †åºã€‚è«‹ç”¨ Markdown è¡¨æ ¼æˆ–æ¸…æ™°çš„åˆ—è¡¨å‘ˆç¾ã€‚`;
                const strategyText = await callGemini(strategyPrompt, []); 
                document.getElementById('weekly-strategy-result').innerHTML = marked.parse(strategyText);
                learningStats.plans_count += 1;

                showToast("å…¨æ–¹ä½åˆ†æå®Œæˆï¼");
            } catch (error) { alert("åˆ†æéç¨‹ç™¼ç”ŸéŒ¯èª¤ï¼š" + error.message); } 
            finally { btn.disabled = false; btn.innerHTML = '<i class="fa-solid fa-rocket"></i> åŸ·è¡Œå…¨æ–¹ä½åˆ†æ (è£œæ•‘+è¨ºæ–·+è¨ˆç•«)'; }
        }

        // --- Exam Prep Logic ---
        async function generateExamMap() {
            if (examUploadedImages.length === 0) { alert("è«‹å…ˆä¸Šå‚³è€ƒè©¦æ•™æçš„åœ–ç‰‡ï¼"); return; }
            document.getElementById('ai-exam-map-result').classList.remove('hidden');
            setLoading('ai-exam-map-result', 'AI æ­£åœ¨åˆ†ææ•™æ...');
            setLoading('ai-exam-plan-result', 'ç­‰å¾…è€ƒé»åœ°åœ–ç”Ÿæˆå¾Œ...');
            setLoading('ai-mock-exam-result', 'ç­‰å¾…è€ƒé»åœ°åœ–ç”Ÿæˆå¾Œ...');

            try {
                learningStats.exam += 1;

                const prompt = `è«‹ä¾ç…§æ‰€æœ‰ä¸Šå‚³çš„æ•™æï¼Œç”Ÿæˆé€™æ¬¡æ®µè€ƒçš„ã€Œå®Œæ•´è€ƒè©¦ç¯„åœåœ°åœ–ã€ï¼Œä¸¦å¹«æˆ‘æŠŠæ¯ä¸€ç« æœ€é‡è¦çš„ä¸‰å€‹è€ƒé»åˆ—å‡ºä¾†ã€‚è«‹ä½¿ç”¨ Markdown æ ¼å¼è¼¸å‡ºã€‚`;
                const text = await callGemini(prompt, examUploadedImages);
                lastExamMapResult = text;
                document.getElementById('ai-exam-map-result').innerHTML = marked.parse(text);
                generateExamPlan();
                generateMockExam();
            } catch (error) { setError('ai-exam-map-result', "ç”Ÿæˆå¤±æ•—ï¼š" + error.message); }
        }

        async function generateExamPlan() {
            if (!lastExamMapResult) return;
            setLoading('ai-exam-plan-result', 'AI æ•™ç·´æ­£åœ¨è¦åŠƒ...');
            const prompt = `åŸºæ–¼ä»¥ä¸‹çš„è€ƒé»åœ°åœ–ï¼š\n${lastExamMapResult}\n\nè«‹ç•¶æˆ‘çš„å¾Œè¨­èªçŸ¥æ•™ç·´ï¼Œæ›¿æˆ‘è¨­è¨ˆ 7 å¤©è¡åˆºè¨ˆç•«ï¼ŒåŒ…å«æ¯æ—¥è®€ä»€éº¼ã€åšå¹¾é¡Œã€å…ˆç†è§£é‚„æ˜¯åˆ·é¡Œã€å¦‚ä½•æª¢æŸ¥ã€‚è«‹ç”¨ Markdown è¡¨æ ¼å‘ˆç¾ã€‚`;
            try {
                const text = await callGemini(prompt, []); 
                document.getElementById('ai-exam-plan-result').innerHTML = marked.parse(text);
                learningStats.plans_count += 1;
            } catch (error) { setError('ai-exam-plan-result', error.message); }
        }

        async function generateMockExam() {
            if (!lastExamMapResult) return;
            setLoading('ai-mock-exam-result', 'AI æ­£åœ¨ç·¨å¯« 10 é¡Œæ¨¡æ“¬è©¦å·...');
            const prompt = `åŸºæ–¼ä»¥ä¸‹çš„è€ƒé»åœ°åœ–ï¼š\n${lastExamMapResult}\n\nè«‹å¹«æˆ‘å‡ºä¸€ä»½ã€Œæ®µè€ƒæ¨¡æ“¬è©¦å·ã€10 é¡Œï¼ŒåŒ…å«ï¼š3 é¡ŒåŸºç¤ã€4 é¡Œç´ é¤Šã€3 é¡Œé«˜é›£åº¦ã€‚ä¸¦çµ¦è§£æã€‚è«‹ä½¿ç”¨ Markdownã€‚`;
            try {
                const text = await callGemini(prompt, []); 
                document.getElementById('ai-mock-exam-result').innerHTML = marked.parse(text);
                learningStats.questions_count += 10;
            } catch (error) { setError('ai-mock-exam-result', error.message); }
        }

        // --- Post-Exam Review Logic ---
        async function analyzeReviewImages() {
            if (reviewUploadedImages.length === 0) { alert("è«‹å…ˆä¸Šå‚³éŒ¯é¡Œåœ–ç‰‡ï¼"); return; }
            setLoading('ai-review-analysis-result', 'AI æ­£åœ¨æ·±åº¦æª¢è¨...');
            const prompt = `è«‹åˆ†æé€™å¼µåœ–ç‰‡ä¸­çš„éŒ¯é¡Œï¼š\n1. åˆ†æè¿·æ€æ¦‚å¿µã€‚\n2. è¨­è¨ˆã€Œ10 åˆ†é˜è£œæ•‘å­¸ç¿’ã€ã€‚\n3. ç”Ÿæˆ 3 é¡Œã€Œè£œæ•‘ç”¨ã€ç·´ç¿’é¡Œ (1 è§€å¿µ, 2 æ‡‰ç”¨) ä¸¦é™„è§£æã€‚\nè«‹ä½¿ç”¨ Markdownã€‚`;
            try {
                learningStats.review += 1;
                const text = await callGemini(prompt, reviewUploadedImages);
                document.getElementById('ai-review-analysis-result').innerHTML = marked.parse(text);
                learningStats.questions_count += 3;
            } catch (error) { setError('ai-review-analysis-result', "åˆ†æå¤±æ•—ï¼š" + error.message); }
        }

        // --- Learn With You Logic ---
        function renderSummary() {
            const container = document.getElementById('summary-container');
            const resultIds = [
                { id: 'ai-flashcards-result', title: 'ğŸ“‡ æ¯æ—¥ - å­¸ç¿’é–ƒå¡' },
                { id: 'ai-mindmap-result', title: 'ğŸ—ºï¸ æ¯æ—¥ - å¿ƒæ™ºåœ–' },
                { id: 'ai-concept-result', title: 'ğŸ’¡ æ¯æ—¥ - è§€å¿µè¬›è§£' },
                { id: 'ai-quiz-result', title: 'ğŸ“ æ¯æ—¥ - 10 é¡Œç·´ç¿’' },
                { id: 'ai-remediation-result', title: 'ğŸ’Š éŒ¯é¡Œè£œæ•‘èˆ‡é¡é¡Œ' },
                { id: 'weekly-diagnosis-result', title: 'ğŸ©º å­¸ç¿’ç›²é»è¨ºæ–·' },
                { id: 'weekly-strategy-result', title: 'ğŸ“… ä¸‹é€±è®€æ›¸ç­–ç•¥' },
                { id: 'ai-exam-map-result', title: 'ğŸ—ºï¸ æ®µè€ƒè€ƒé»åœ°åœ–' },
                { id: 'ai-exam-plan-result', title: 'ğŸƒ æ®µè€ƒ 7 å¤©è¡åˆºè¡¨' },
                { id: 'ai-mock-exam-result', title: 'âœï¸ æ®µè€ƒæ¨¡æ“¬è©¦å·' },
                { id: 'ai-review-analysis-result', title: 'ğŸ” è€ƒå¾Œæª¢è¨å ±å‘Š' }
            ];

            let contentHTML = "";
            let hasContent = false;

            resultIds.forEach(item => {
                const el = document.getElementById(item.id);
                if (el && el.innerText.length > 50 && !el.innerText.includes('ç­‰å¾…') && !el.innerText.includes('ç”Ÿæˆå¤±æ•—')) {
                    hasContent = true;
                    contentHTML += `
                        <div class="bg-white border border-gray-200 rounded-lg p-4 shadow-sm">
                            <h4 class="font-bold text-gray-700 mb-2 border-b pb-2">${item.title}</h4>
                            <div class="prose prose-sm max-w-none text-gray-600">${el.innerHTML}</div>
                        </div>
                    `;
                }
            });

            if (hasContent) container.innerHTML = contentHTML;
            else container.innerHTML = `<p class="text-gray-400 text-center py-10 text-sm">ç›®å‰é‚„æ²’æœ‰ç”Ÿæˆçš„å…§å®¹ï¼Œå¿«å»å…¶ä»–é é¢é–‹å§‹å­¸ç¿’å§ï¼</p>`;
        }

        async function askAI() {
            const input = document.getElementById('ask-ai-input');
            const question = input.value.trim();
            if (!question) { alert("è«‹è¼¸å…¥æ‚¨çš„å•é¡Œï¼"); return; }

            const responseContainer = document.getElementById('ai-chat-response');
            responseContainer.classList.remove('hidden');
            responseContainer.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> AI æ€è€ƒä¸­...';

            const summaryHTML = document.getElementById('summary-container').innerText;
            const context = summaryHTML.length > 50 ? `\n\nã€åƒè€ƒèƒŒæ™¯è³‡è¨Š (æˆ‘å‰›å‰›ç”Ÿæˆçš„å­¸ç¿’å…§å®¹)ã€‘:\n${summaryHTML.substring(0, 2000)}...` : "";
            const prompt = `æˆ‘æ˜¯ä¸€å€‹å­¸ç”Ÿï¼Œæ­£åœ¨ä½¿ç”¨ AI è®€æ›¸è¨ˆç•«å·¥å…·ã€‚\næˆ‘çš„å•é¡Œæ˜¯ï¼š${question}\n${context}\nè«‹æ ¹æ“šä¸Šè¿°èƒŒæ™¯è³‡è¨Šï¼ˆå¦‚æœæœ‰çš„è©±ï¼‰ï¼Œå›ç­”æˆ‘çš„å•é¡Œã€‚`;

            try {
                const text = await callGemini(prompt, []);
                responseContainer.innerHTML = marked.parse(text);
                input.value = "";
            } catch (error) { responseContainer.innerHTML = `<span class="text-red-500">å›ç­”å¤±æ•—: ${error.message}</span>`; }
        }

        // --- Utilities ---
        function copyText(text) { navigator.clipboard.writeText(text).then(() => showToast("å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿")); }
        function copyDynamic(type) { copyText(type); } // Stub for legacy
        function updateDailyPrompts() { updateDisplay('daily-unit', 'daily-unit-display'); updateDisplay('daily-task', 'daily-task-display'); }
        function updateExamPrompts() { updateDisplay('exam-subject', 'exam-subject-display'); updateDisplay('exam-status', 'exam-status-display'); }
        function updateReviewPrompts() { updateDisplay('review-units', 'review-units-display'); }
        function updateQuickPrompt() { updateDisplay('quick-subject', 'quick-subject-display'); }
        function updateDisplay(inputId, displayClass) {
            const val = document.getElementById(inputId).value;
            document.querySelectorAll('.' + displayClass).forEach(el => el.innerText = val ? val : "____");
        }
        let toastTimeout;
        function showToast(msg) {
            const toast = document.getElementById('toast');
            if(msg) document.getElementById('toast-msg').innerText = msg;
            toast.classList.remove('translate-x-[150%]');
            if (toastTimeout) clearTimeout(toastTimeout);
            toastTimeout = setTimeout(() => { toast.classList.add('translate-x-[150%]'); }, 2500);
        }
    </script>
</body>
</html>
